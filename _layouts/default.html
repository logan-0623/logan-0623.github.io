<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'en' }}">
<head>
  {%- include head.html -%}
  <link rel="stylesheet" href="{{ '/assets/css/transition.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/assets/css/custom.css' | relative_url }}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/locomotive-scroll@4.1.4/dist/locomotive-scroll.min.css" />
  <link href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap" rel="stylesheet">

  <style>
    body.fade { opacity: 0; transition: opacity 0.5s; }
    body.fade.fade-in { opacity: 1; }
    .loader {
      position: fixed; z-index: 9999; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(10,10,10,0.6); display: flex; justify-content: center; align-items: center;
      backdrop-filter: blur(4px); transition: opacity 0.3s;
    }
    .loader.hidden { opacity: 0; pointer-events: none; }
    #transition-bar { width: 60vw; height: 6px; border-radius: 3px; background: linear-gradient(90deg, #934B43, #b4dced 60%); animation: loadingBar 1s infinite alternate; }
    @keyframes loadingBar { 0% { width: 30vw; } 100% { width: 60vw; } }
    /* ä¸»é¢˜æŒ‰é’®ç­‰æ ·å¼è¯·ç”¨ä½ è‡ªå·±çš„ custom.css è¦†ç›–ï¼Œå‡å°‘å†—ä½™ */
  </style>

</head>
<body>
  <!-- Loading åŠ¨ç”» -->
  <div class="loader hidden" id="page-loader">
    <div id="page-brush"></div>
    <div id="transition-bar"></div>
</div>

  


  <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
  <button class="theme-switch" onclick="toggleTheme()">
    <span class="theme-icon">ğŸ´</span>
  </button>

  <!-- å¹³æ»‘æ»šåŠ¨ä¸»å®¹å™¨ -->
  <div data-scroll-container>
    {%- include header.html -%}

    <main class="page-content" aria-label="Content" data-scroll-section>
      <div class="wrapper">
        {{ content }}
      </div>
    </main>

    {%- include footer.html -%}
  </div>

  <!-- JS: ä¾èµ–é¡ºåºä¸èƒ½ä¹± -->
  <script src="{{ '/assets/js/gsap.js' | relative_url }}"></script>
  <script src="{{ '/assets/js/ScrollTrigger.js' | relative_url }}"></script>
  <script src="https://cdn.jsdelivr.net/npm/locomotive-scroll@4.1.4/dist/locomotive-scroll.min.js"></script>
  <script src="{{ '/assets/js/transition.js' | relative_url }}"></script>
  <script src="{{ '/assets/js/custom.js' | relative_url }}"></script>
  
  <script>
    // é¡µé¢æ·¡å…¥ + è·³è½¬åŠ è½½åŠ¨ç”»
    document.addEventListener("DOMContentLoaded", () => {
    document.body.classList.add("fade-in");
    const links = document.querySelectorAll('a[href]:not([target="_blank"]):not([href^="#"])');

    links.forEach(link => {
      link.addEventListener("click", function (e) {
        const href = this.getAttribute("href");
        if (!href || href.startsWith("http")) return;
        e.preventDefault();
        showTransitionBar(); // å¯åŠ¨è¿›åº¦æ¡åŠ¨ç”»
        document.body.classList.remove("fade-in");
        setTimeout(() => { window.location.href = href; }, 1600); // åŠ¨ç”»æ—¶é—´ > timeline
      });
    });
  });


    // Locomotive Scroll + GSAP ScrollTrigger è”åŠ¨
    window.addEventListener('load', () => {
      const scrollContainer = document.querySelector('[data-scroll-container]');
      const locoScroll = new LocomotiveScroll({
        el: scrollContainer,
        smooth: true,
        multiplier: 1.1,
        smoothMobile: true
      });

      // ======= å…³é”®ï¼šGSAP-ScrollTriggeré›†æˆ =======
      gsap.registerPlugin(ScrollTrigger);

      // scrollerProxy å¿…é¡»æ”¾åœ¨ locomotive åˆå§‹åŒ–å
      ScrollTrigger.scrollerProxy(scrollContainer, {
        scrollTop(value) {
          return arguments.length ? locoScroll.scrollTo(value, 0, 0) : locoScroll.scroll.instance.scroll.y;
        },
        getBoundingClientRect() {
          return {top: 0, left: 0, width: window.innerWidth, height: window.innerHeight};
        },
        pinType: scrollContainer.style.transform ? "transform" : "fixed"
      });

      // åˆ·æ–° ScrollTrigger/locomotive
      locoScroll.on("scroll", ScrollTrigger.update);
      ScrollTrigger.addEventListener("refresh", () => locoScroll.update());
      ScrollTrigger.refresh();

      // === ä¾‹å­ï¼šæ»šåŠ¨åŠ¨ç”»ï¼ŒæŒ‰éœ€å®šåˆ¶ ===
      gsap.utils.toArray('.wrapper').forEach(el => {
        gsap.fromTo(el, {opacity: 0, y: 80}, {
          opacity: 1, y: 0, duration: 1.1,
          scrollTrigger: {
            trigger: el,
            scroller: scrollContainer,
            start: "top 80%",
            end: "bottom 20%",
            scrub: 1,
            markers: false
          }
        });
      });
    });

    // ===== Loading Progress Bar Timeline =====
  let tl = gsap.timeline({
    paused: true,
    repeat: 1,         // åŠ¨ç”»æ¥å›ä¸€æ¬¡ï¼ˆä¸¤æ¬¡å®Œæ•´å¾ªç¯ï¼‰ï¼Œå¯æ”¹ä¸º repeat: 2
    yoyo: true,
    defaults: {
      duration: 0.8,
      ease: "power1.inOut"
    },
    onComplete: () => {
      hideTransitionBar();
    }
  });

  // å®½åº¦åŠ¨ç”»ä» 0% åˆ° 100%
  tl.to("#transition-bar", { width: "100%" });

  // æ˜¾ç¤ºå¹¶æ’­æ”¾è¿›åº¦æ¡åŠ¨ç”»
  function showTransitionBar() {
    const loader = document.getElementById("page-loader");
    const bar = document.getElementById("transition-bar");
    if (!bar) return;
    bar.style.opacity = "1";
    bar.style.width = "0%";
    loader.classList.remove("hidden");
    tl.restart();
  }

  // éšè—è¿›åº¦æ¡åŠ¨ç”»å’Œ loader
  function hideTransitionBar() {
    const bar = document.getElementById("transition-bar");
    if (!bar) return;
    gsap.to(bar, {
      opacity: 0,
      duration: 0.3,
      onComplete: () => {
        bar.style.width = "0%";
        bar.style.opacity = "";
        document.getElementById('page-loader')?.classList.add('hidden');
      }
    });
  }



  </script>
</body>
</html>

